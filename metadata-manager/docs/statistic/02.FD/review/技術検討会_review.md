# 列統計・表統計管理機能 レビュー

技術検討会 2021/01/20

技術検討会 2021/01/22

## FD

* 次のAPIまで説明した。
  
    * 1テーブルの表統計登録・更新（input：テーブル名・行数）
    
    
    
* 指摘：★処置済み
  
    * [指摘箇所]
      * 列統計テーブル
    * [指摘内容]
      * スロットがよくわからない
    * [処置内容]
      * [pg_statisticに格納される値の調査](../調査/research_pg_statistic.md)
    
* 指摘：★処置済み
    * [指摘箇所]
      * Tableメタデータテーブルを追加した理由
    * [指摘内容]
      * 目的を書く
    
* 指摘：★処置済み
    * [指摘箇所]
      * メタデータ格納先のテーブル
    * [指摘内容]
      * スキーマ書いてない。pg_catalog?
    * [処置内容]
      * tsurugi_catalog
    
* 指摘：★処置済み
    * [指摘箇所]
      * メタデータ格納先のテーブル
    * [指摘内容]
      * CRUDの権限はどうするか。
      * ユーザーはどうするか。
    * [処置内容]
      * SuperuserのみにPostgreSQLのすべての操作権限を付与する。
* 指摘：★処置済み
    * [指摘箇所]
      * メタデータ格納先のテーブル
    * [指摘内容]
      * V2.0とのスキーマは変えてない。
      * 概要の理由を書く。
        * そのあとで、細かい理由を書く。


* 指摘：★処置済み

  * [指摘箇所]
    * 1テーブルの全列統計削除（input：テーブルID）
  * [指摘内容]
    * ALTER TABLEは？
  * [処置内容]
    * APIを追加した。

  

* 指摘：★処置済み

  * [指摘箇所]1カラムの列統計登録・更新（input：テーブル名・カラム名）
  * [指摘内容]
    * テーブル名からテーブルIDを取得する。
      * トランザクションの途中でテーブル名が変わった場合、トランザクションにしているから大丈夫？
  * [処置内容]
    * APIのinputを変更した。

* 指摘：★処置済み

  * [指摘箇所]
    * 列統計登録・更新API
      
  * [指摘内容]
    * 仕様の記述不足
      * full updateなのか部分更新可能なのか書く
        * 全部の列統計を更新しないといけない。
        * 列統計の追加差分はない。


* 指摘：★堀川さんと認識を合わせ

  * [指摘箇所]

     * 全APIのinputがテーブルID

  * [指摘内容]

     * ogawayamaはテーブル名しか認識していない？
      

* 指摘：★処置済み

  * [指摘箇所]
    * データベース名
  * [指摘内容]
    * tsurugi?
    * template

* 指摘：★処置済み

  * [指摘箇所]
    * HTAPテーブル
  * [指摘内容]
    * 列が違う可能性がある。
  * [処置内容]
    * 覚えておくだけなので、問題なし。

* 指摘：★処置済み

  * [指摘箇所]
    * FD全体
  * [指摘内容]
    * 処理詳細まではかかなくてよい。
  * [処置内容]
    * 処理詳細を書かないと機能がわかりにくいため、書くこととした。

* 指摘：★処置済み

  * [指摘箇所]
    * クラス図
  * [指摘内容]
    * namespace float4

* 指摘：★処置済み

  * [指摘箇所]
    * FD全体
  * [指摘内容]
    * V2.0と同等ではなくて、自分で考えて、改善できるところは改善する。


## DD

* 指摘
    * [指摘箇所]
    * [指摘内容]
* 指摘
    * [指摘箇所]
    * [指摘内容]
* 指摘
    * [指摘箇所]
    * [指摘内容]
* 指摘
    * [指摘箇所]
    * [指摘内容]
* 指摘
    * [指摘箇所]
    * [指摘内容]

## API usage

* 指摘：★処置済み
    * [指摘箇所]表統計エンティティ
    * [指摘内容]TableMetadata
    * [処置内容]TableStatisticに変更した
* 指摘：★処置済み
    * [指摘箇所]initialize,finalizeは分かりにくい。
    * [指摘内容]UNIXのソケットのAPIを参考にしてみたらよいかも？(open,close?)
    * [処置内容]
      * UNIXのソケットのAPIを参考に、メソッド名を次のように変更した。
        * サービス層のクラス
          * initialize -> connect
          * finalize -> close
        * DBSessionManagerのクラス
          * open -> connect

* 指摘：★堀川さんと認識を合わせ
    * [指摘箇所]
       * 1カラムの列統計登録・更新のAPIのみ
    * [指摘内容]
       * 1回のfunction callで複数カラムの列統計登録・更新を行うAPIは必要か？
* 指摘
    * [指摘箇所]
    * [指摘内容]
* 指摘
    * [指摘箇所]
    * [指摘内容]

## その他

* 指摘
    * [指摘箇所]
    * [指摘内容]
* 指摘
    * [指摘箇所]
    * [指摘内容]
