# 列統計・表統計管理機能 技術検討会 2021/01/29

## APIの部分の修正点（クラス名、メソッド名、型の変更について）

1. 表統計エンティティのクラス名
    * [指摘内容]TableMetadata
    
    * [処置内容]TableStatisticに変更した
    
      
    
2. APIのメソッド名initialize,finalizeは分かりにくい。
    * [指摘内容]UNIXのソケットのAPIを参考にしてみたらよいかも？(open,close?)
    * [処置内容]
      * UNIXのソケットのAPIを参考に、メソッド名を次のように変更した。
        * サービス層のクラス
          * initialize -> connect
          * finalize -> close
        * DBSessionManagerのクラス
          
          * open -> connect
          
            
    
3. 各APIの引数をuint64_tからint64_tに変更

    * 理由

      * メタデータ格納先(PostgreSQL)のテーブルの型bigint＝int64_tだからです。
      * uint64_tだと、bigintの最大値の倍入るため、分かりにくいと思ったため。
        * int64_tの最大値
          * (2^63-1)
        * uint64_tの最大値
          * (2^64-1)

    * 修正内容

      * metadata-managerのAPIで、メタデータ格納先(PostgreSQL)のテーブルの型 bigint or bigserialに対応するAPIの引数

        * int64_t

          * -(2^63)から+(2^63-1)

            

      * 【参考】メタデータ格納先のテーブルのbigint or bigserialの型を持つ列

        * テーブルメタデータのテーブルID、カラムメタデータのカラムID
          
          * bigserial	8バイト	広範囲自動増分整数	1から(2^63-1)
        * カラムメタデータのカラム番号、データタイプID、direction
      
          * bigint	8バイト	広範囲整数	-(2^63)から+(2^63-1)
          
            
    
4. 行数reltuplesの型

   * メタデータ格納先(PostgreSQL)のテーブルの型

     * real

   * metadata-managerのAPIの引数

     * float

       

   * 理由

     * PostgreSQLシステムカタログのテーブルメタデータテーブルpg_classの行数の型と同じ型とするため。
     * PostgreSQLのrealは、C++のfloatとほぼ同じ。
       * APIのinputをfloatとした場合の挙動
         * APIに**floatの最大値**をinputしたとき、APIはPostgreSQLから**floatの最大値**が取得できる。
         * APIに**doubleの最大値**をinputしたとき、APIはPostgreSQLから**inf**が取得できる。
