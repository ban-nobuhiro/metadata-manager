<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>manager: message-broker API</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">manager
   &#160;<span id="projectnumber">..</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">message-broker API </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>2020.08.14 NEC</p>
<h2>用語</h2>
<ul>
<li>派生Receiver<ul>
<li>Receiverクラスを継承するクラス</li>
</ul>
</li>
</ul>
<h2>クラス図</h2>
<div class="image">
<img src="img/out/Message/Message.png"/>
</div>
<h2>各クラスの説明</h2>
<h3>Status</h3>
<h4>説明</h4>
<ul>
<li>send_message()およびreceive_message()の戻り値</li>
</ul>
<h4>フィールド</h4>
<ul>
<li>フィールド一覧</li>
</ul>
<table class="doxtable">
<tr>
<th>フィールド名</th><th>説明</th><th>エラーコードを管理するリポジトリ名</th><th>エラーコードを管理する名前空間  </th></tr>
<tr>
<td>error_code</td><td>概要エラーコード</td><td>manager/message-broker</td><td><a class="el" href="namespacemanager_1_1message.html">manager::message</a> </td></tr>
<tr>
<td>sub_error_code</td><td>詳細エラーコード</td><td>派生Receiverが配置されるリポジトリ</td><td>派生Receiverで管理 </td></tr>
</table>
<ul>
<li>概要エラーコードと詳細エラーコードの対応表</li>
</ul>
<table class="doxtable">
<tr>
<th>error_code</th><th>sub_error_code  </th></tr>
<tr>
<td>SUCCESS</td><td>派生Receiverで管理される成功したときのエラーコードをint型にキャストした値。 例)(int)ogawayama::stub::ErrorCode::OK </td></tr>
<tr>
<td>FAILURE</td><td>派生Receiverで管理される成功以外のエラーコードをint型にキャストした値。 例)(int)ogawayama::stub::ErrorCode::UNKNOWN,(int)ogawayama::stub::ErrorCode::SERVER_FAILUREなど </td></tr>
</table>
<h3>MessageBroker</h3>
<h4>説明</h4>
<ul>
<li>メッセージを送信する。</li>
</ul>
<h4>メソッド</h4>
<ul>
<li>Status send_message(Message* message)<ul>
<li>処理内容：MessageBrokerは、Messageクラスにセットされたすべての派生Receiverに対して、receive_message()メソッドでメッセージを送信する。</li>
<li>条件<ul>
<li>事前条件：Messageクラスのすべてのフィールドがセットされている。</li>
<li>事後条件：<ul>
<li>派生Receiverが返した概要エラーコードが「FAILURE」である場合、「FAILURE」が返ってきた時点で即座に、Statusクラスのインスタンスを返す。</li>
<li>すべての派生Receiverが返した概要エラーコードが「SUCCESS」である場合、Statusクラスのコンストラクタに次の値をセットして返す。 <table class="doxtable">
<tr>
<th>フィールド名</th><th>値  </th></tr>
<tr>
<td>error_code </td><td>SUCCESS </td></tr>
<tr>
<td>sub_error_code </td><td>(int)SUCCESS </td></tr>
</table>
* 詳細は<a href="#status">Status</a>を参照。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3>Message</h3>
<h4>説明</h4>
<ul>
<li>メッセージの内容、メッセージの受信者である派生Receiverリストを保持する。</li>
</ul>
<h4>フィールド</h4>
<table class="doxtable">
<tr>
<th>フィールド名</th><th>説明  </th></tr>
<tr>
<td>id</td><td>メッセージID。ユーザーが入力した構文に応じて、すべての派生Receiverにその構文を伝えるためID。 </td></tr>
<tr>
<td>object_id</td><td>追加・更新・削除される対象のオブジェクトID 例）テーブルメタデータのオブジェクトID </td></tr>
<tr>
<td>receivers</td><td>メッセージの受信者である派生Receiverリスト。例）OltpReceiver、OlapReceiver </td></tr>
<tr>
<td>message_type_name</td><td>エラーメッセージ出力用の文字列　例）"CREATE TABLE" </td></tr>
</table>
<ul>
<li>id<ul>
<li>型:列挙型(enum class)<ul>
<li>規定型:int</li>
<li>次の通り管理する。<ul>
<li>リポジトリ名：manager/message-broker</li>
<li>名前空間：manager::message</li>
</ul>
</li>
<li>メッセージID一覧 <table class="doxtable">
<tr>
<th>メッセージID</th><th>ユーザーが入力した構文  </th></tr>
<tr>
<td>CREATE_TABLE</td><td>CREATE TABLE構文 </td></tr>
</table>
<h4>メソッド</h4>
</li>
</ul>
</li>
</ul>
</li>
<li>void set_receiver(Receiver *receiver_)<ul>
<li>Messageクラスの派生Receiverリストに、派生Receiverをセットする。</li>
</ul>
</li>
</ul>
<h4>Message派生クラス一覧</h4>
<table class="doxtable">
<tr>
<th>クラス名</th><th>ユーザーが入力した構文  </th></tr>
<tr>
<td>CreateTableMessage</td><td>CREATE TABLE構文 </td></tr>
</table>
<h3>Receiver</h3>
<h4>説明</h4>
<ul>
<li>メッセージを受信する。</li>
<li>抽象クラス。</li>
</ul>
<h4>メソッド</h4>
<ul>
<li>Status receive_message(Message* message)<ul>
<li>抽象メソッド。実際の処理は、派生Receiverが行う。</li>
<li>処理内容：派生Receiverは、Messageクラスのインスタンスを受け取り、message-&gt;get_id()を利用してMessageIdを取得する。MessageIdに応じて処理の実行または、実行を指示する。get_object_id()を利用して、追加・更新・削除される対象のオブジェクトIDを取得する。</li>
<li>条件<ul>
<li>事前条件：なし</li>
<li>事後条件：<ul>
<li>派生Receiverは、MessageIdに対応する処理を実行後、Statusクラスのインスタンスを生成する。このとき、コンストラクタで概要エラーコード・詳細エラーコードをセットする。生成したStatusクラスのインスタンスを返す。</li>
<li>詳細は<a href="#status">Status</a>を参照。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>以上 </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
